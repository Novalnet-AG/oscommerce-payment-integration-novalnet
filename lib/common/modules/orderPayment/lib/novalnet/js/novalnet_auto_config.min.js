/**
 * This file is used for auto configuration of merchant details
 *
 * @author      Novalnet
 * @copyright   Copyright (c) Novalnet
 * @license     https://www.novalnet.de/payment-plugins/kostenlos/lizenz
 *
 * Script: novalnet_auto_config.js
 *
*/
function process_response(e){var t=$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_TARIFF]"]'),n=$('select[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_TARIFF]"]'),a=$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_TARIFF]"]').val();if(n.is("select"))n.empty();else n=$('<select name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_TARIFF]">');var i=e.merchant.tariff;$.each(i,(function(e,t){var i=$("<option>").val(e).text(t.name);n.append(i),a&&a==e&&i.prop("selected",!0)})),t.replaceWith(n)}$(document).ready((function(){$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_JS_FILE]"]').hide(),$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_DIR_PATH]"]').hide();var e=$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_SIGNATURE]"]'),t=$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_PAYMENT_ACCESS_KEY]"]'),n=$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_WEBHOOK]"]');""!==e.val()&&""!==t.val()?c("merchant_details"):$('input[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_TARIFF]"]').val(""),e.add(t).on("change",(function(){c("merchant_details")}));var a="Are you sure you want to configure the Webhook URL in Novalnet Admin Portal?",i="Please enter the valid Webhook URL",o="Please enter a valid Product Activation Key and Payment Access key",l="Please enter a valid Product Activation Key",r="Please enter a valid Payment Access Key",s="Notification / Webhook URL is configured successfully in Novalnet Admin Portal";function c(a){var i={activation_key:e.val(),access_key:t.val(),action:a,lang:$("#getlang").val()};"webhook_configure"==a&&(i.callback_url=$.trim(n.val())),""!==e.val()&&""!==t.val()?$.ajax({url:$("#dir").val()+"lib/common/modules/orderPayment/lib/novalnet/novalnet_auto_config.php",method:"POST",data:i,success:function(n){var i=JSON.parse(n);"merchant_details"==a&&"SUCCESS"==i.result.status?process_response(i):"merchant_details"==a?(alert(i.result.status_text),e.val(""),t.val(""),$('select[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_TARIFF]"]').text("")):100==i.result.status_code?alert(s):alert(i.result.status_text)},error:function(e,t,n){console.log("Error:",t,e.responseText)}}):$('select[name="configuration[MODULE_PAYMENT_NOVALNET_PAYMENTS_TARIFF]"]').text("")}"DE"==$("#getlang").val()&&(a="Sind Sie sicher, dass Sie die Webhook-URL im Novalnet Admin Portal konfigurieren möchten?",i="Bitte geben Sie eine gültige Webhook-URL ein",o="Bitte geben Sie den gültigen Produktaktivierungsschlüssel und Paymentzugriffsschlüssel ein",s="Callbackskript-/ Webhook-URL wurde erfolgreich im Novalnet Admin Portal konfiguriert",l="Bitte geben Sie den gültigen Produktaktivierungsschlüssel",r="Bitte geben Sie den gültigen Paymentzugriffsschlüssel ein"),$(".conf").off("click").on("click",(function(l){if(""!==e.val()&&""!==t.val()){url_val=$.trim(n.val());var r=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;if(r.test(url_val))return!!confirm(a)&&(l.preventDefault(),l.stopPropagation(),c("webhook_configure"),!0);if(!r.test(url_val)||""===url_val||void 0===url_val)return alert(i),!1}else l.preventDefault(),l.stopPropagation(),alert(o)})),$(".btn-right button").on("click",(function(n){""!=e.val()&&""!=t.val()||(n.stopPropagation(),n.preventDefault(),alert(""==e.val()?l:r))}))}));